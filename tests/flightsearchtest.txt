import { test, chromium, expect } from '@playwright/test';
import { Homepage } from '../pages/HomePage';
import { FlightResultsPage } from '../pages/FlightResultsPage';

test('Automate Air India Flight Search with Stealth Mode', async () => {
  test.setTimeout(600000);

  const context = await chromium.launchPersistentContext('', {
    headless: false,
    viewport: null,
    args: [
      '--start-maximized',
      '--no-sandbox',
      '--disable-blink-features=AutomationControlled',
    ],
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36',
  });
  

  const page = context.pages()[0] || await context.newPage();

  await page.addInitScript(() => {
    Object.defineProperty(navigator, 'webdriver', {
      get: () => false,
    });
  });

  const homepage = new Homepage(page);

  await page.goto('https://www.airindia.com');
  console.log('Navigated to Air India homepage');

  await homepage.preparePageStealth();
  await homepage.acceptCookies();
  console.log(' Accepted cookies');

  await homepage.selectTripType("Round Trip", '6-2025', 'Sunday', 'June', 8, 'June', '6-2025', 18, 'Wednesday');
  console.log(' Selected Trip Type: Round Trip');

  await homepage.setupGeolocationPermissions();
  console.log(' Geolocation permission granted');

  await homepage.enterFromCity('Delhi');
  await homepage.enterToCity('Mumbai');

  await Promise.all([
    page.waitForURL(/\/booking\/availability\/\d+/, { timeout: 20000 }),
    homepage.clickSearch(),
  ]);

  expect(page.url()).toMatch(/\/booking\/availability\/\d+/);
  console.log('Successfully navigated to search results page!');

  const flightResultsPage = new FlightResultsPage(page);

  await flightResultsPage.applyNonStopCheckboxFilter();
  await flightResultsPage.applyNonStopFilterViaPopup();
  await flightResultsPage.extractFlightDetails();
  await flightResultsPage.captureFinalScreenshot('screenshots/final.png');

  console.log('Test finished successfully');

  await page.waitForTimeout(15000);
  await context.close(); 
  
});






























import { test, chromium, expect } from '@playwright/test';
import { Homepage } from '../pages/HomePage';
import { FlightResultsPage } from '../pages/FlightResultsPage';

test('One-Way Flight Search: Delhi → Mumbai', async () => {
  test.setTimeout(600000);
  const context = await chromium.launchPersistentContext('', { /* ... */ });
  const page = context.pages()[0] || await context.newPage();
  await page.addInitScript(() => {
    Object.defineProperty(navigator, 'webdriver', { get: () => false });
  });
  const homepage = new Homepage(page);
  await page.goto('https://www.airindia.com');
  await homepage.preparePageStealth();
  await homepage.acceptCookies();
  await homepage.selectTripType("One Way", '6-2025', 'Sunday', 'June', 8, 'June', '6-2025', 18, 'Wednesday');
  await homepage.setupGeolocationPermissions();
  await homepage.enterFromCity('Delhi');
  await homepage.enterToCity('Mumbai');
  await Promise.all([
    page.waitForURL(/\/booking\/availability\/\d+/, { timeout: 20000 }),
    homepage.clickSearch(),
  ]);
  expect(page.url()).toMatch(/\/booking\/availability\/\d+/);
  const flightResultsPage = new FlightResultsPage(page);
  await flightResultsPage.applyNonStopCheckboxFilter();
  await flightResultsPage.applyNonStopFilterViaPopup();
  await flightResultsPage.extractFlightDetails();
  await flightResultsPage.captureFinalScreenshot('screenshots/final_oneway.png');
  await context.close();
});

test('Round-Trip Flight Search: Delhi ↔ Mumbai', async () => {
  test.setTimeout(600000);
  const context = await chromium.launchPersistentContext('', { /* ... */ });
  const page = context.pages()[0] || await context.newPage();
  await page.addInitScript(() => {
    Object.defineProperty(navigator, 'webdriver', { get: () => false });
  });
  const homepage = new Homepage(page);
  await page.goto('https://www.airindia.com');
  await homepage.preparePageStealth();
  await homepage.acceptCookies();
  await homepage.selectTripType("Round Trip", '6-2025', 'Sunday', 'June', 8, 'June', '6-2025', 18, 'Wednesday');
  await homepage.setupGeolocationPermissions();
  await homepage.enterFromCity('Delhi');
  await homepage.enterToCity('Mumbai');
  await Promise.all([
    page.waitForURL(/\/booking\/availability\/\d+/, { timeout: 20000 }),
    homepage.clickSearch(),
  ]);
  expect(page.url()).toMatch(/\/booking\/availability\/\d+/);
  const flightResultsPage = new FlightResultsPage(page);
  await flightResultsPage.applyNonStopCheckboxFilter();
  await flightResultsPage.applyNonStopFilterViaPopup();
  await flightResultsPage.extractFlightDetails();
  await flightResultsPage.captureFinalScreenshot('screenshots/final_roundtrip.png');
  await context.close();
});















import { test, chromium, expect } from '@playwright/test';
import { Homepage } from '../pages/HomePage';
import { FlightResultsPage } from '../pages/FlightResultsPage';

const testCases: { tripType: "One Way" | "Round Trip"; screenshotName: string }[] = [
  { tripType: "One Way", screenshotName: "final_oneway.png" },
  { tripType: "Round Trip", screenshotName: "final_roundtrip.png" }
];

for (const [index, testCase] of testCases.entries()) {
  test(`${testCase.tripType} Flight Search: Delhi → Mumbai`, async () => {
    test.setTimeout(600000);
    const context = await chromium.launchPersistentContext('', { /* ... options */ });
    const page = context.pages()[0] || await context.newPage();

    await page.addInitScript(() => {
      Object.defineProperty(navigator, 'webdriver', { get: () => false });
    });

    const homepage = new Homepage(page);
    await page.goto('https://www.airindia.com');
    await homepage.preparePageStealth();
    await homepage.acceptCookies();

    await homepage.selectTripType(
      testCase.tripType,
      '6-2025', 'Sunday', 'June', 8,
      'June', '6-2025', 18, 'Wednesday'
    );

    await homepage.setupGeolocationPermissions();
    await homepage.enterFromCity('Delhi');
    await homepage.enterToCity('Mumbai');

    await Promise.all([
      page.waitForURL(/\/booking\/availability\/\d+/, { timeout: 20000 }),
      homepage.clickSearch(),
    ]);

    expect(page.url()).toMatch(/\/booking\/availability\/\d+/);

    const flightResultsPage = new FlightResultsPage(page);
    await flightResultsPage.applyNonStopCheckboxFilter();
    await flightResultsPage.applyNonStopFilterViaPopup();
    await flightResultsPage.extractFlightDetails();
    await flightResultsPage.captureFinalScreenshot(`screenshots/${testCase.screenshotName}`);
    
    await context.close();
  });
}
